name: PostgreSQL RDS Workflow

on:
  pull_request:
     branches: 
      - development
      - uat
      - release
      - main 
jobs:
  check_pull_request_body:
  
    if: ${{ contains(github.event.pull_request.body , '[x] PostgresRDS') }}
    
    runs-on: ubuntu-latest
    env:
      DB_HOST: ${{ secrets.DB_HOST }}
      DB_PORT: ${{ secrets.DB_PORT }}
      DB_DATABASE: ${{ secrets.DB_DATABASE }}
      DB_USERNAME: ${{ secrets.DB_USERNAME }}
      DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
     # Adding a comment for triggering PostgresRDS
      - name: Run on Postgres RDS
        run: |
          echo "Pull request body matches 'PostgresRDS'. Performing Postgres RDS Workflow..."
          echo "PGPASSWORD=<password> psql -h <hostname> -p <port> -d <database> -U <username>"
          
      - name: Install psql
        run: sudo apt-get install postgresql-client

      - name: Apply SQL Files
        run: |
          for file in $(find . -type f -name '*.sql'); do
            psql -h $DB_HOST -p $DB_PORT -d $DB_DATABASE -U $DB_USERNAME -W < $file
          done

          
  continuous_integration:
  
      if: ${{ contains(github.event.pull_request.body , '[x] CI') }}
      runs-on: ubuntu-latest
      steps:
        - name: Checkout repository
          uses: actions/checkout@v3

        - name: Perform CI Workflow
          run: |
            echo "Pull request body matches 'CI', Performing CI Workflow..."
              
